# Codetriever Development Environment Stack
# Purpose: Ensure consistent development environment for native + Docker deployments
# Usage: source stack.env && just validate-stack

# Rust Toolchain
RUST_TOOLCHAIN=stable
RUST_EDITION=2024
CARGO_RESOLVER=3

# Build Configuration  
BUILD_FLAGS="--strict --warnings-as-errors"
CARGO_TERM_COLOR=always

# Development Tools
JUST_VERSION=1.35.0
RUSTFMT_VERSION=stable
CLIPPY_VERSION=stable

# Platform Requirements (enforced by validate-stack)
MIN_MACOS_VERSION=12.0
MIN_UBUNTU_VERSION=20.04
# Note: Windows requires WSL2 (Windows 10+)

# CI Environment Specification
CI_ENV=gh-actions
CI_RUST_TOOLCHAIN=stable
CI_CACHE_VERSION=v2

# Codetriever Configuration
export CODETRIEVER_ENV="${CODETRIEVER_ENV:-development}"
export EMBEDDING_BACKEND="${EMBEDDING_BACKEND:-native}"
export QDRANT_URL="${QDRANT_URL:-http://localhost:6334}"
export USE_METAL="${USE_METAL:-true}"
export EMBEDDING_MODEL="${EMBEDDING_MODEL:-jina-embeddings-v2-base-code}"

# Test Configuration
# Test profiles: fast (dev), thorough (pre-commit), ci (GitHub Actions)
TEST_PROFILE="${TEST_PROFILE:-fast}"

# Test environment variables based on profile  
case "$TEST_PROFILE" in
    fast)
        export TEST_TIMEOUT_MS=5000
        export TEST_ITERATIONS=10
        ;;
    thorough)
        export TEST_TIMEOUT_MS=10000
        export TEST_ITERATIONS=100
        ;;
    ci)
        export TEST_TIMEOUT_MS=120000  # 2 minutes for CI
        export TEST_ITERATIONS=1000
        ;;
    *)
        echo "⚠️  Unknown test profile: $TEST_PROFILE (using 'fast' defaults)"
        export TEST_TIMEOUT_MS=5000
        export TEST_ITERATIONS=10
        ;;
esac

# Validation Commands:
# > source stack.env
# > just validate-stack
# > MAOS_TEST_PROFILE=thorough just test