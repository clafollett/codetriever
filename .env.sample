# =============================================================================
# CODETRIEVER CONFIGURATION
# =============================================================================
# All settings have safe defaults. Only override what you need to change.
# Configuration hierarchy: HuggingFace model config → code defaults → .env overrides
#
# ⚠️  SECURITY WARNING: Default credentials are for LOCAL DEVELOPMENT ONLY!
# ⚠️  NEVER use default credentials in production environments!


# =============================================================================
# NOTES
# =============================================================================
# - Copy this file to .env and customize as needed
# - DO NOT commit .env to version control (it's in .gitignore)
# - For production, always use secure, unique credentials
# - See docs/configuration.md for detailed configuration guide

# =============================================================================
# EMBEDDING MODEL CONFIGURATION
# =============================================================================

# Model identifier from HuggingFace
# Default: jinaai/jina-embeddings-v2-base-code
CODETRIEVER_EMBEDDING_MODEL=jinaai/jina-embeddings-v2-base-code

# Maximum tokens per chunk (must be ≤ model's max_position_embeddings)
# JinaBERT v2 supports up to 8192, but smaller is faster and uses less memory
# Default: 512 (good balance of context and performance)
# Range: 128-8192 (validated against model limits at runtime)
# CODETRIEVER_EMBEDDING_MAX_TOKENS=512

# Embedding vector dimensions (must match model output)
# JinaBERT v2 produces 768-dimensional vectors
# Default: 768 (read from model config)
# CODETRIEVER_EMBEDDING_DIMENSION=768

# =============================================================================
# BATCHING & PERFORMANCE CONFIGURATION
# =============================================================================

# Indexer batch size - controls GPU memory usage during indexing
# How many chunks processed in parallel during model forward pass
# Smaller = less memory, Larger = better GPU utilization
# Default: 64 (balance for most systems)
# Memory usage ≈ batch_size × max_tokens × dimensions × 4 bytes × 12 layers
# CODETRIEVER_EMBEDDING_INDEXER_BATCH_SIZE=64

# Search batch size - how many user queries batched together (API only)
# Only relevant for multi-user API scenarios
# Default: 8 (typical concurrent users)
# CODETRIEVER_EMBEDDING_SEARCH_BATCH_SIZE=8

# Model pool size - number of model instances for parallel inference
# More models = more parallelism but uses more memory (~2GB per model)
# Default: 2 (minimum for parallelism)
# CODETRIEVER_EMBEDDING_POOL_SIZE=2

# Batch collection timeout in milliseconds
# How long to wait collecting requests before processing batch
# Default: 10ms (low latency)
# CODETRIEVER_EMBEDDING_BATCH_TIMEOUT_MS=10

# GPU acceleration settings
# Default: true (auto-detect and use GPU if available)
# CODETRIEVER_EMBEDDING_USE_GPU=true
# CODETRIEVER_EMBEDDING_GPU_DEVICE=metal  # metal, cuda:0, mps, etc.

# Memory limit in MB for model operations
# Prevents OOM errors by constraining model memory usage
# CODETRIEVER_EMBEDDING_MEMORY_LIMIT_MB=8192

# =============================================================================
# MODEL CACHING CONFIGURATION
# =============================================================================

# Cache directory for downloaded models
# Models are large (~2GB) so caching prevents repeated downloads
# Default: ~/.cache/codetriever or .cache/codetriever
# CODETRIEVER_EMBEDDING_CACHE_DIR=~/.cache/codetriever

# Enable model caching to disk
# Default: true
# CODETRIEVER_EMBEDDING_CACHE_ENABLED=true

# Maximum cache size in MB to prevent disk exhaustion
# Old models are evicted when limit is reached
# CODETRIEVER_EMBEDDING_CACHE_MAX_SIZE_MB=10240

# =============================================================================
# PARSING & CHUNKING CONFIGURATION
# =============================================================================

# Maximum chunk size in tokens (should match CODETRIEVER_EMBEDDING_MAX_TOKENS)
# Default: 512
# CODETRIEVER_INDEXING_MAX_CHUNK_TOKENS=512

# Whether to split large code units (functions/classes) that exceed max_tokens
# If false, large functions stored as single chunks (will be truncated by model!)
# Default: true (always split for accuracy)
# NOTE: Chunk overlap has been removed - we rely on semantic boundaries + byte offsets for context
# CODETRIEVER_INDEXING_SPLIT_LARGE_UNITS=true

# Number of concurrent indexing tasks
# Controls parallelism during file processing
# Default: 4
# CODETRIEVER_INDEXING_CONCURRENCY_LIMIT=4

# =============================================================================
# DATABASE CONFIGURATION (PostgreSQL)
# =============================================================================

# Database connection parameters
# Default values match code constants
DB_HOST=localhost
DB_PORT=5432
DB_NAME=codetriever
DB_USER=codetriever
DB_PASSWORD=localdev123
DB_SSLMODE=disable

# Alternative: Full connection URL (overrides individual parameters)
# CODETRIEVER_DATABASE_URL=postgresql://codetriever:localdev123@localhost:5432/codetriever

# Connection pool settings
# CODETRIEVER_DATABASE_MAX_CONNECTIONS=5
# CODETRIEVER_DATABASE_MIN_CONNECTIONS=2
# CODETRIEVER_DATABASE_TIMEOUT_SECONDS=30
# CODETRIEVER_DATABASE_IDLE_TIMEOUT_SECONDS=300

# Auto-run migrations on startup
# Default: true
# CODETRIEVER_DATABASE_AUTO_MIGRATE=true

# =============================================================================
# VECTOR DATABASE CONFIGURATION (Qdrant)
# =============================================================================

# Qdrant server URL
# Default: http://localhost:6334
QDRANT_URL=http://localhost:6334

# Qdrant API key (optional - for production security)
# If set, this API key will be automatically used for all Qdrant connections
# QDRANT_API_KEY=your_secure_api_key_here

# Alternative config via prefixed vars:
# CODETRIEVER_VECTOR_STORAGE_URL=http://localhost:6334
# CODETRIEVER_VECTOR_STORAGE_COLLECTION_NAME=codetriever
# CODETRIEVER_VECTOR_STORAGE_DIMENSION=768
# CODETRIEVER_VECTOR_STORAGE_TIMEOUT_SECONDS=30

# =============================================================================
# API SERVER CONFIGURATION
# =============================================================================

# Server host (localhost only for security by default)
# Default: 127.0.0.1
# CODETRIEVER_API_HOST=127.0.0.1

# Server port
# Default: 3000
# CODETRIEVER_API_PORT=3000

# Request timeout in seconds
# Default: 60
# CODETRIEVER_API_TIMEOUT_SECONDS=60

# Enable CORS for cross-origin requests
# Default: true
# CODETRIEVER_API_ENABLE_CORS=true

# Enable OpenAPI/Swagger documentation
# Default: true
# CODETRIEVER_API_ENABLE_DOCS=true

# =============================================================================
# TELEMETRY & OBSERVABILITY CONFIGURATION
# =============================================================================

# Enable telemetry collection
# Default: false (opt-in)
# CODETRIEVER_TELEMETRY_ENABLED=false

# OpenTelemetry endpoint URL
# CODETRIEVER_TELEMETRY_OTLP_ENDPOINT=http://localhost:4317

# Tracing level (trace, debug, info, warn, error)
# Default: info
# CODETRIEVER_TELEMETRY_TRACING_LEVEL=info

# Enable metrics collection
# Default: false
# CODETRIEVER_TELEMETRY_ENABLE_METRICS=false

# Metrics server port (0 = random port)
# Default: 0 (random port, OS-assigned)
# Example: CODETRIEVER_TELEMETRY_METRICS_PORT=9090

# Sample rate for traces (0.0 to 1.0)
# Default: 0.1 (10% sampling)
# CODETRIEVER_TELEMETRY_TRACE_SAMPLE_RATE=0.1

# Service name for telemetry
# Default: codetriever
# CODETRIEVER_TELEMETRY_SERVICE_NAME=codetriever

# Environment label for telemetry
# Default: development
# CODETRIEVER_TELEMETRY_ENVIRONMENT=development

# =============================================================================
# ADVANCED / OPTIONAL SETTINGS
# =============================================================================

# System memory in MB (for validation)
# If set, prevents configurations that exceed 80% of system memory
# CODETRIEVER_SYSTEM_MEMORY_MB=8192

# Legacy compatibility (deprecated - do not use)
# EMBEDDING_MODEL=jinaai/jina-embeddings-v2-base-code
# EMBEDDING_BACKEND=native
# HF_TOKEN=your_huggingface_token
# CODETRIEVER_ENV=data
